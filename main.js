const translations = {
    pt: {
        role: "Gestão Comercial & Desenvolvimento Digital",
        section_summary: "Resumo",
        summary_text: "Profissional com atuação híbrida em Gestão Comercial e Desenvolvimento Digital. Combino experiência prática em vendas consultivas de alto valor com competência técnica em desenvolvimento web e produção audiovisual. Foco em execução: utilizo dados para qualificar leads, crio ferramentas digitais para otimizar processos e produzo conteúdo visual para suporte direto a vendas. Orientado a eficiência operacional e resultados financeiros.",
        section_experience: "Experiencia Profissional",
        job1_title: "Analista de Vendas e Processos",
        job1_desc1: "<strong>Vendas Consultivas:</strong> Gestão integral do ciclo de vendas de imóveis com ticket médio entre R$ 120k e R$ 2.5M, com atuação em ativos acima de R$ 13M.",
        job1_desc2: "<strong>Qualificação de Leads:</strong> Uso de análise de dados para filtragem de oportunidades no CRM, aumentando a taxa de conversão real do funil.",
        job1_desc3: "<strong>Otimização de Rotina:</strong> Reestruturação de processos de follow-up e atendimento, reduzindo o tempo operacional gasto por cliente.",
        job2_title: "Fundador e Presidente",
        job2_desc1: "<strong>Gestão Institucional:</strong> Fundou e estruturou juridicamente a entidade, liderando uma equipe operacional de 30 membros.",
        job2_desc2: "<strong>Controle Financeiro:</strong> Assumiu o caixa do zero e entregou a gestão com superávit líquido de +R$ 4.000 através de controle de custos e receita.",
        job2_desc3: "<strong>Execução de Projetos:</strong> Organizou e supervisionou a execução de eventos e projetos acadêmicos com foco em viabilidade econômica.",
        job3_title: "Produtor Digital e Desenvolvedor",
        job3_company: "Autônomo",
        job3_desc1: "<strong>Projetos Web:</strong> Desenvolvimento de interfaces e landing pages (HTML/CSS/JS) focadas em conversão e performance.",
        job3_desc2: "<strong>Produção Audiovisual:</strong> Edição e motion graphics (Premiere/After Effects) para comunicação corporativa e materiais de venda.",
        job3_desc3: "<strong>Automação:</strong> Criação de scripts e ferramentas simples para automação de tarefas repetitivas e organização de fluxo de trabalho.",
        job4_title: "Assistente de Importação",
        job4_desc1: "<strong>Comércio Exterior:</strong> Operacionalização de processos de importação/exportação e gestão de relacionamento com cadeia de suprimentos internacional.",
        section_skills: "Habilidades Técnicas",
        skill_cat1: "Design e Audiovisual",
        skill_cat2: "Negócios e Ferramentas",
        section_education: "Formação Acadêmica",
        edu1_title: "Relações Internacionais (Bacharelado)",
        edu2_title: "Técnico em Administração",
        section_languages: "Idiomas",
        lang1_name: "Português",
        lang1_details: "Nativo",
        lang2_name: "Inglês",
        lang2_details: "Fluente (Vivência Internacional & Comércio Exterior)",
        lang3_name: "Espanhol",
        lang3_details: "Profissional (Foco em leitura e compreensão corporativa)",
        lang4_name: "Africâner",
        lang4_details: "Básico (Noções gerais)",
        section_activities: "Atividades Extracurriculares",
        act1_desc: "Gestão estratégica de Imagem Pública e comunicação corporativa para o Interact e Rotaract Club.",
        act2_title: "Intercâmbio (Rotary Youth Exchange)",
        act2_desc: "África do Sul.",
        tab_experiments: "Experimentos",
        tab_comex: "Notícias ComEx",
        tab_international: "Notícias Internacionais",
        tab_comex_title: "Notícias ComEx",
        tab_comex_desc: "Em breve: Feed de notícias sobre Comércio Exterior.",
        tab_intl_title: "Notícias Internacionais",
        tab_intl_desc: "Em breve: Feed de notícias internacionais."
    },
    en: {
        role: "Commercial Management & Digital Development",
        section_summary: "Summary",
        summary_text: "Hybrid professional in Commercial Management and Digital Development. I combine practical experience in high-value consultative sales with technical competence in web development and audiovisual production. Focus on execution: I use data to qualify leads, build digital tools to optimize processes, and produce visual content for direct sales support. Oriented towards operational efficiency and financial results.",
        section_experience: "Professional Experience",
        job1_title: "Sales & Process Analyst",
        job1_desc1: "<strong>Consultative Sales:</strong> Full management of the sales cycle for real estate assets ranging from R$ 120k to R$ 2.5M, handling assets exceeding R$ 13M.",
        job1_desc2: "<strong>Lead Qualification:</strong> Use of data analysis for opportunity filtering in CRM, increasing the funnel's actual conversion rate.",
        job1_desc3: "<strong>Routine Optimization:</strong> Restructuring of follow-up and service processes, reducing operational time spent per client.",
        job2_title: "Founder & President",
        job2_desc1: "<strong>Institutional Management:</strong> Founded and legally structured the entity, leading an operational team of 30 members.",
        job2_desc2: "<strong>Financial Control:</strong> Started with zero cash flow and delivered the tenure with a net surplus of +R$ 4,000 through cost and revenue control.",
        job2_desc3: "<strong>Project Execution:</strong> Organized and supervised the execution of events and academic projects focusing on economic viability.",
        job3_title: "Digital Producer & Developer",
        job3_company: "Freelance",
        job3_desc1: "<strong>Web Projects:</strong> Development of interfaces and landing pages (HTML/CSS/JS) focused on conversion and performance.",
        job3_desc2: "<strong>Audiovisual Production:</strong> Editing and motion graphics (Premiere/After Effects) for corporate communication and sales materials.",
        job3_desc3: "<strong>Automation:</strong> Creation of scripts and simple tools for automating repetitive tasks and organizing workflows.",
        job4_title: "Import Assistant",
        job4_desc1: "<strong>Foreign Trade:</strong> Operationalization of import/export processes and relationship management with the international supply chain.",
        section_skills: "Technical Skills",
        skill_cat1: "Design & Audiovisual",
        skill_cat2: "Business & Tools",
        section_education: "Education",
        edu1_title: "International Relations (Bachelor's)",
        edu2_title: "Business Administration Technician",
        section_languages: "Languages",
        lang1_name: "Portuguese",
        lang1_details: "Native",
        lang2_name: "English",
        lang2_details: "Fluent (International Experience & Foreign Trade)",
        lang3_name: "Spanish",
        lang3_details: "Professional (Focus on corporate reading and comprehension)",
        lang4_name: "Afrikaans",
        lang4_details: "Basic (General notions)",
        section_activities: "Extracurricular Activities",
        act1_desc: "Strategic management of Public Image and corporate communication for Interact and Rotaract Club.",
        act2_title: "Exchange Program (Rotary Youth Exchange)",
        act2_desc: "South Africa.",
        tab_experiments: "Experiments",
        tab_comex: "ComEx News",
        tab_international: "International News",
        tab_comex_title: "ComEx News",
        tab_comex_desc: "Coming soon: Foreign Trade news feed.",
        tab_intl_title: "International News",
        tab_intl_desc: "Coming soon: International news feed."
    },
    es: {
        role: "Gestión Comercial y Desarrollo Digital",
        section_summary: "Resumen",
        summary_text: "Profesional con enfoque híbrido en Gestión Comercial y Desarrollo Digital. Combino experiencia práctica en ventas consultivas de alto valor con competencia técnica en desarrollo web y producción audiovisual. Enfoque en ejecución: utilizo datos para calificar leads, creo herramientas digitales para optimizar procesos y produzco contenido visual para soporte directo a ventas. Orientado a la eficiencia operativa y resultados financieros.",
        section_experience: "Experiencia Profesional",
        job1_title: "Analista de Ventas y Procesos",
        job1_desc1: "<strong>Ventas Consultivas:</strong> Gestión integral del ciclo de ventas de inmuebles con ticket medio entre R$ 120k y R$ 2.5M, actuando en activos superiores a R$ 13M.",
        job1_desc2: "<strong>Calificación de Leads:</strong> Uso de análisis de datos para filtrado de oportunidades en CRM, aumentando la tasa de conversión real del embudo.",
        job1_desc3: "<strong>Optimización de Rutina:</strong> Reestructuración de procesos de seguimiento y atención, reduciendo el tiempo operativo gastado por cliente.",
        job2_title: "Fundador y Presidente",
        job2_desc1: "<strong>Gestión Institucional:</strong> Fundó y estructuró legalmente la entidad, liderando un equipo operativo de 30 miembros.",
        job2_desc2: "<strong>Control Financiero:</strong> Asumió la caja desde cero y entregó la gestión con un superávit neto de +R$ 4.000 a través del control de costos e ingresos.",
        job2_desc3: "<strong>Ejecución de Proyectos:</strong> Organizó y supervisó la ejecución de eventos y proyectos académicos con enfoque en viabilidad económica.",
        job3_title: "Productor Digital y Desarrollador",
        job3_company: "Autónomo",
        job3_desc1: "<strong>Proyectos Web:</strong> Desarrollo de interfaces y landing pages (HTML/CSS/JS) enfocadas en conversión y rendimiento.",
        job3_desc2: "<strong>Producción Audiovisual:</strong> Edición y motion graphics (Premiere/After Effects) para comunicación corporativa y materiales de venta.",
        job3_desc3: "<strong>Automatización:</strong> Creación de scripts y herramientas simples para la automatización de tareas repetitivas y organización del flujo de trabajo.",
        job4_title: "Asistente de Importación",
        job4_desc1: "<strong>Comercio Exterior:</strong> Operacionalização de processos de importação/exportação e gestão de relações com a cadeia de suprimento internacional.",
        section_skills: "Habilidades Técnicas",
        skill_cat1: "Diseño y Audiovisual",
        skill_cat2: "Negocios y Herramientas",
        section_education: "Formación Académica",
        edu1_title: "Relaciones Internacionales (Licenciatura)",
        edu2_title: "Técnico em Administração",
        section_languages: "Idiomas",
        lang1_name: "Portugués",
        lang1_details: "Nativo",
        lang2_name: "Inglés",
        lang2_details: "Fluido (Vivencia Internacional y Comercio Exterior)",
        lang3_name: "Español",
        lang3_details: "Profesional (Enfoque en lectura y comprensión corporativa)",
        lang4_name: "Afrikáans",
        lang4_details: "Básico (Nociones generales)",
        section_activities: "Actividades Extracurriculares",
        act1_desc: "Gestión estratégica de Imagen Pública y comunicación corporativa para Interact y Rotaract Club.",
        act2_title: "Intercambio (Rotary Youth Exchange)",
        act2_desc: "Sudáfrica.",
        tab_experiments: "Experimentos",
        tab_comex: "Noticias ComEx",
        tab_international: "Noticias Internacionales",
        tab_comex_title: "Noticias ComEx",
        tab_comex_desc: "Próximamente: Noticias sobre Comercio Exterior.",
        tab_intl_title: "Noticias Internacionales",
        tab_intl_desc: "Próximamente: Noticias internacionales."
    }
};

function setLanguage(lang) {
    document.documentElement.lang = lang;

    // Update buttons
    document.querySelectorAll('.lang-btn').forEach(btn => {
        const isActive = btn.textContent.toLowerCase() === lang;
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');
    });

    // Update text
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang][key]) {
            element.innerHTML = translations[lang][key];
        }
    });
}

// Theme Toggle Logic
document.addEventListener('DOMContentLoaded', () => {
    const themeToggleBtns = document.querySelectorAll('.theme-toggle');
    const htmlElement = document.documentElement;

    const applyTheme = (isDark, persist = false) => {
        htmlElement.classList.toggle('dark', isDark);
        if (persist) {
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }
        themeToggleBtns.forEach(btn => btn.setAttribute('aria-pressed', isDark ? 'true' : 'false'));
        window.dispatchEvent(new CustomEvent('themechange', { detail: { isDark } }));
    };

    const storedTheme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const initialDark = storedTheme ? storedTheme === 'dark' : prefersDark;
    applyTheme(initialDark);

    if (!storedTheme && window.matchMedia) {
        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        mediaQuery.addEventListener('change', (event) => applyTheme(event.matches));
    }

    themeToggleBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const nextState = !htmlElement.classList.contains('dark');
            applyTheme(nextState, true);
        });
    });

    // Ensure language buttons have correct aria-pressed on load
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.setAttribute('aria-pressed', btn.classList.contains('active') ? 'true' : 'false');
    });

    // Initialize Sidebar Logic
    generateOutline('#resume-view');
    setupScrollSpy('#resume-view');
});

// View Switching Logic
function switchView(viewName) {
    const resumeView = document.getElementById('resume-view');
    const playgroundView = document.getElementById('playground-view');
    
    // Update Sidebar Buttons using data-view attribute
    document.querySelectorAll('.sidebar-item').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-view') === viewName) {
            btn.classList.add('active');
        }
    });

    const isResume = viewName === 'resume';
    const hideEl = isResume ? playgroundView : resumeView;
    const showEl = isResume ? resumeView : playgroundView;

    // Use transition helper
    animateTransition(hideEl, showEl, () => {
        if (isResume && window.Experiments) {
            if (typeof window.Experiments.stopCurrent === 'function') {
                window.Experiments.stopCurrent();
            }
        }
        const selector = isResume ? '#resume-view' : '#playground-view';
        generateOutline(selector);
        setTimeout(() => setupScrollSpy(selector), 100);
    });
}

// Utility: debounce
function debounce(fn, wait) {
    let t;
    return function(...args) {
        clearTimeout(t);
        t = setTimeout(() => fn.apply(this, args), wait);
    };
}

// Experiment Logic
function openExperiment(type) {
    const dashboard = document.getElementById('playground-dashboard');
    const container = document.getElementById('experiment-container');
    const views = document.querySelectorAll('.experiment-view');
    const targetView = document.getElementById(`${type}-view`);

    if (!targetView) return;

    // Animate Dashboard -> Experiment Container
    animateTransition(dashboard, container, () => {
        // Ensure only target view is visible within container
        views.forEach(v => v.style.display = 'none');
        targetView.style.display = 'block';

        // Start the experiment logic
        initExperimentLogic(type, targetView);
    });
}

function initExperimentLogic(type, view) {
        // Initialize experiment with options from controls
        const formatVal = (v) => {
            if (typeof v !== 'number') return v;
            if (Math.abs(v) >= 100) return Math.round(v);
            if (Math.abs(v) >= 1) return Math.round(v * 100) / 100;
            // small numbers: show up to 5 significant digits
            return parseFloat(v.toPrecision(4));
        };

        const readOptions = () => {
            const opts = {};
            const controls = view.querySelectorAll('.exp-control');
            controls.forEach(ctrl => {
                const name = ctrl.name;
                let val = ctrl.value;
                // coerce numeric values
                if (val !== undefined && val !== null && val !== '') {
                    if (val.indexOf('.') >= 0) val = parseFloat(val);
                    else val = parseFloat(val);
                }
                opts[name] = val;
                // update label if exists
                const label = view.querySelector(`#${type}-${name}-label`) || view.querySelector(`#${type}-${name}-label`);
                if (label) label.textContent = formatVal(val);
            });
            return opts;
        };

        const startWithOptions = (opts) => {
            if (Experiments && Experiments[type]) {
                // Stop previous first
                Experiments.stopCurrent();

                // Start new experiment and store the returned instance
                const result = Experiments[type](`${type}Canvas`, opts);

                // Support older-style cleanup functions (function) or the new instance object
                if (typeof result === 'function') {
                    Experiments.currentInstance = { cleanup: result, setOptions: null };
                } else if (result && typeof result === 'object') {
                    Experiments.currentInstance = result;
                } else {
                    Experiments.currentInstance = null;
                }

                Experiments.activeId = type;
            }
        };

        // Start immediately
        startWithOptions(readOptions());

        // Wire controls to re-init experiment on change (debounced)
        if (view._expBound && Array.isArray(view._expBound)) {
            // remove old listeners
            view._expBound.forEach(b => b.el.removeEventListener('input', b.handler));
        }
        const bound = [];
        view.querySelectorAll('.exp-control').forEach(ctrl => {
            const handler = debounce(() => {
                const opts = readOptions();
                // If the experiment supports live updates, prefer setOptions
                if (Experiments && Experiments.currentInstance && typeof Experiments.currentInstance.setOptions === 'function') {
                    try {
                        const res = Experiments.currentInstance.setOptions(opts);
                        // If the instance signals a re-init is required, restart entirely
                        if (res && res.requiresReinit) {
                            startWithOptions(opts);
                        }
                        return;
                    } catch (err) {
                        console.warn('setOptions failed, reinitializing:', err);
                        startWithOptions(opts);
                        return;
                    }
                }

                // Fallback: re-init
                startWithOptions(opts);
            }, 250);
            ctrl.addEventListener('input', handler);
            bound.push({ el: ctrl, handler });
        });
        view._expBound = bound;

        generateOutline('#playground-view');
        setupScrollSpy('#playground-view');
}

function closeExperiment() {
    const dashboard = document.getElementById('playground-dashboard');
    const container = document.getElementById('experiment-container');
    
    // Animate Container -> Dashboard
    animateTransition(container, dashboard, () => {
        // Capture active id so we can remove listeners, then stop experiment
        const prevActive = Experiments ? Experiments.activeId : null;
        if (Experiments) Experiments.stopCurrent();
        if (prevActive) {
            const activeView = document.getElementById(`${prevActive}-view`);
            if (activeView && activeView._expBound) {
                activeView._expBound.forEach(b => b.el.removeEventListener('input', b.handler));
                activeView._expBound = null;
            }
        }
        generateOutline('#playground-view');
        setupScrollSpy('#playground-view');
    });
}

// Make functions global for HTML access
window.openExperiment = openExperiment;
window.closeExperiment = closeExperiment;
window.switchView = switchView;
window.setLanguage = setLanguage;
window.toggleSidebar = toggleSidebar;
window.toggleDesktopSidebar = toggleDesktopSidebar;

// Sidebar Toggle Logic
function toggleSidebar() {
    const sidebar = document.querySelector('.doc-sidebar');
    const overlay = document.querySelector('.sidebar-overlay');
    const isOpen = sidebar.classList.contains('open');
    
    if (isOpen) {
        sidebar.classList.remove('open');
        overlay.classList.remove('active');
        document.body.style.overflow = '';
    } else {
        sidebar.classList.add('open');
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent background scrolling
    }
}

function toggleDesktopSidebar() {
    const isCollapsed = document.body.classList.toggle('sidebar-collapsed');
    localStorage.setItem('sidebar-collapsed', isCollapsed ? 'true' : 'false');
    
    // Trigger resize event for canvas experiments to adjust
    setTimeout(() => {
        window.dispatchEvent(new Event('resize'));
    }, 300);
}

// Close sidebar when clicking a link on mobile
document.addEventListener('DOMContentLoaded', () => {
    // Restore Sidebar State (Default to collapsed if not set)
    const storedSidebarState = localStorage.getItem('sidebar-collapsed');
    
    // If 'true' OR null (first visit), collapse it.
    if (storedSidebarState === 'true' || storedSidebarState === null) {
        document.body.classList.add('sidebar-collapsed');
    } else {
        document.body.classList.remove('sidebar-collapsed');
    }

    // ...existing code...
    
    // Close sidebar on link click (mobile)
    const sidebarLinks = document.querySelectorAll('.sidebar-item, .outline-item');
    sidebarLinks.forEach(link => {
        link.addEventListener('click', () => {
            if (window.innerWidth <= 900) {
                const sidebar = document.querySelector('.doc-sidebar');
                if (sidebar.classList.contains('open')) {
                    toggleSidebar();
                }
            }
        });
    });
});

// Outline Generation Logic
function generateOutline(rootSelector = '#resume-view') {
    const outlineList = document.querySelector('.outline-list');
    const root = document.querySelector(rootSelector);
    if (!outlineList || !root) return;
    const sections = Array.from(root.querySelectorAll('h2')).filter(section => section.offsetParent !== null);
    
    outlineList.innerHTML = ''; // Clear existing

    if (!sections.length) {
        const empty = document.createElement('div');
        empty.className = 'outline-empty';
        empty.textContent = 'Sem seções disponíveis.';
        outlineList.appendChild(empty);
        return;
    }

    sections.forEach((section, index) => {
        if (!section.id) {
            section.id = `${rootSelector.replace('#', '')}-section-${index}`;
        }

        const link = document.createElement('a');
        link.className = 'outline-item';
        link.textContent = section.textContent;
        link.href = `#${section.id}`;
        
        link.addEventListener('click', (e) => {
            e.preventDefault();
            section.scrollIntoView({ behavior: 'smooth' });
        });

        outlineList.appendChild(link);
    });
}

// Scroll Spy Logic (Highlight active section in outline)
function setupScrollSpy(rootSelector = '#resume-view') {
    const sections = Array.from(document.querySelectorAll(`${rootSelector} h2`)).filter(section => section.offsetParent !== null);
    const outlineItems = document.querySelectorAll('.outline-item');

    if (!sections.length || !outlineItems.length) {
        return;
    }

    const observerOptions = {
        root: null,
        rootMargin: '-10% 0px -80% 0px', // Trigger when section is near top
        threshold: 0
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                // Remove active class from all
                outlineItems.forEach(item => item.classList.remove('active'));
                
                // Add active class to corresponding link
                const id = entry.target.id;
                const activeLink = document.querySelector(`.outline-item[href="#${id}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
            }
        });
    }, observerOptions);

    sections.forEach(section => observer.observe(section));
}

/*
 * Helper to animate elements out before hiding them,
 * and animate elements in after showing them.
 */
function animateTransition(hideElement, showElement, onComplete) {
    // Helper to execute switch immediately if no animation is needed/possible
    const immediateSwitch = () => {
        if (hideElement) {
            hideElement.style.display = 'none';
            hideElement.classList.remove('anim-fade-out');
        }
        if (showElement) {
            showElement.style.display = 'block';
            showElement.classList.remove('anim-fade-in');
        }
        if (onComplete) onComplete();
    };

    if (!hideElement || !showElement) {
        immediateSwitch();
        return;
    }

    // Check if animations are enabled/supported
    const isReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (isReducedMotion) {
        immediateSwitch();
        return;
    }

    // Safety timeout in case animationend never fires
    const safetyTimer = setTimeout(() => {
        console.warn('Animation timeout - forcing transition');
        handleOutEnd();
    }, 300); // Slightly longer than CSS animation (0.2s)

    // 1. Animate Out
    hideElement.classList.add('anim-fade-out');

    const handleOutEnd = () => {
        clearTimeout(safetyTimer);
        hideElement.classList.remove('anim-fade-out');
        hideElement.style.display = 'none';
        hideElement.removeEventListener('animationend', handleOutEnd);

        // 2. Switch
        showElement.style.display = 'block';
        showElement.classList.add('anim-fade-in');

        // Safety timer for in-animation
        const inSafetyTimer = setTimeout(() => {
            handleInEnd();
        }, 400); // Slightly longer than CSS animation (0.3s)

        // 3. Animate In
        const handleInEnd = () => {
            clearTimeout(inSafetyTimer);
            showElement.classList.remove('anim-fade-in');
            showElement.removeEventListener('animationend', handleInEnd);
            if (onComplete) onComplete();
        };
        showElement.addEventListener('animationend', handleInEnd);
    };

    hideElement.addEventListener('animationend', handleOutEnd);
}

// Playground Tab Switching Logic
function switchPlaygroundTab(tabId) {
    // 1. Update Buttons
    const buttons = document.querySelectorAll('.pg-tab-btn');
    buttons.forEach(btn => {
        // Simple logic: if onclick contains the tabId, it's the active one
        // A robust way is to check the tab index or passed argument match
        // But here we can just check the onclick string or add data-tab attribute
        // Let's rely on the order or check the onclick attribute content
        if (btn.getAttribute('onclick').includes(tabId)) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });

    // 2. Show/Hide Content
    const contents = document.querySelectorAll('.pg-tab-content');
    contents.forEach(content => {
        content.classList.remove('active');
    });

    const target = document.getElementById(`tab-${tabId}`);
    if (target) {
        target.classList.add('active');
        
        // Update Sidebar Outline for the new tab
        generateOutline('#playground-view');
        setTimeout(() => setupScrollSpy('#playground-view'), 100);
    }
}

// Expose to global scope
window.switchPlaygroundTab = switchPlaygroundTab;
